<script>
  const status = document.getElementById('status');
  const burnBtn = document.getElementById('burnBtn');
  const host = window.location.host;
  const API_SAVE = `https://${host}/api/save`;
  const API_GET = `https://${host}/api/get/`;

  burnBtn.onclick = async () => {
    const text = document.getElementById('paste').value.trim();
    if (!text) {
      status.textContent = '→ Nothing to burn...';
      return;
    }

    status.textContent = 'Burning...';
    burnBtn.disabled = true;

    try {
      const res = await fetch(API_SAVE, {
        method: 'POST',
        headers: {'Content-Type': 'text/plain'},
        body: text
      });

      if (!res.ok) {
        const errorText = await res.text();
        throw new Error(`Server said: ${res.status} ${errorText}`);
      }

      const key = await res.text();
      const link = `https://${host}/${key}`;

      document.getElementById('url-box').value = link;
      document.getElementById('url-box').style.display = 'inline-block';
      status.textContent = 'Success! Your paste is live. → ' + link;
    } catch (e) {
      status.innerHTML = `Error: ${e.message}<br>Check F12 Console or Railway logs.`;
      console.error(e);
    } finally {
      burnBtn.disabled = false;
    }
  };

  // Load paste if key in URL
  (async () => {
    const key = location.pathname.slice(1);
    if (!key) return;

    document.getElementById('editor').style.display = 'none';
    document.getElementById('view').style.display = 'block';

    try {
      const res = await fetch(API_GET + key);
      if (!res.ok) throw new Error();
      const text = await res.text();
      const code = document.querySelector('#view code');
      code.textContent = text;
      hljs.highlightElement(code);
    } catch {
      document.body.innerHTML += '<h2 style="color:red;text-align:center;">Paste expired or not found</h2>';
    }
  })();
</script>
